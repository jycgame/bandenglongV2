require=function r(c,s,i){function l(t,e){if(!s[t]){if(!c[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var a=s[t]={exports:{}};c[t][0].call(a.exports,function(e){return l(c[t][1][e]||e)},a,a.exports,r,c,s,i)}return s[t].exports}for(var u="function"==typeof require&&require,e=0;e<i.length;e++)l(i[e]);return l}({RankItem:[function(e,t,n){"use strict";cc._RF.push(t,"49771mD4dtAVqCy4ehmO+Op","RankItem"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,r=(o.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.iconSprite=null,e.nameLabel=null,e.scoreLabel=null,e.rankLabel=null,e}return __extends(e,t),e.prototype.start=function(){this.rankLabel=this.node.children[0].getComponent(cc.Label),this.iconSprite=this.node.children[1].getComponent(cc.Sprite),this.nameLabel=this.node.children[2].getComponent(cc.Label),this.scoreLabel=this.node.children[3].getComponent(cc.Label)},e.prototype.set=function(e,t,n,o){this.nameLabel.string=t,this.scoreLabel.string=n.toString(),this.createImage(e),o&&(this.rankLabel.string=o.toString())},e.prototype.createImage=function(e){var t=this,n=wx.createImage();n.onload=function(){var e=new cc.Texture2D;e.initWithElement(n),e.handleLoadedTexture(),t.iconSprite.spriteFrame=new cc.SpriteFrame(e)},n.src=e},e=__decorate([a],e)}(cc.Component));n.default=r,cc._RF.pop()},{}],RankManager:[function(e,t,n){"use strict";cc._RF.push(t,"d36dc2dUg1IRLZxNfCMt0vm","RankManager"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,r=o.property,s=e("./RankItem"),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.RankListNode=null,e.PlayerRankItem=null,e}return __extends(e,t),e.prototype.start=function(){var t=this;wx.onMessage(function(e){cc.log("接收主域发来消息：",e),0==e.messageType?t.GetFriendRank():1==e.messageType?t.SetScore(e.score):e.messageType})},e.prototype.SetScore=function(t){wx.getUserCloudStorage({keyList:["score"],success:function(e){console.log("getUserCloudStorage","success",e),0!=e.KVDataList.length&&e.KVDataList[0].value>t&&(t=e.KVDataList[0].value),wx.setUserCloudStorage({KVDataList:[{key:"score",value:t.toString()}],success:function(e){console.log("setUserCloudStorage","success",e)},fail:function(e){console.log("setUserCloudStorage","fail")},complete:function(e){console.log("setUserCloudStorage","ok")}})},fail:function(e){console.log("getUserCloudStorage","fail")},complete:function(e){console.log("getUserCloudStorage","ok")}})},e.prototype.GetFriendRank=function(){var c=this;wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){console.log("success",e.data);var r=e.data[0];wx.getFriendCloudStorage({keyList:["score"],success:function(e){console.log("wx.getFriendCloudStorage success",e);var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value});for(var n=0;n<t.length;n++){var o=t[n],a=0!=o.KVDataList.length?o.KVDataList[0].value:0;if(n<5)c.RankListNode.children[n].getComponent(s.default).set(o.avatarUrl,o.nickname,a);t[n].avatarUrl==r.avatarUrl&&c.PlayerRankItem.set(o.avatarUrl,o.nickname,a,n+1)}},fail:function(e){console.log("wx.getFriendCloudStorage fail",e)}})},fail:function(e){cc.log("数据加载失败。")}})},__decorate([r(cc.Node)],e.prototype,"RankListNode",void 0),__decorate([r(s.default)],e.prototype,"PlayerRankItem",void 0),e=__decorate([a],e)}(cc.Component);n.default=c,cc._RF.pop()},{"./RankItem":"RankItem"}]},{},["RankItem","RankManager"]);